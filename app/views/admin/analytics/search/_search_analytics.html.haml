
%h3 Report for the last 7 days (#{Date.current-7.days} - #{Date.yesterday})


%h4 Search data overview
%table.table
  %tr
    %th Metric
    %th Total
  %tr
    %td Number of visits
    %td= total_number_of_visits
  %tr
    %td Number of searches
    %td= total_number_of_searches
  %tr
    %td Average number of searches per visit (includes only visits with searches)
    %td= avg_number_searches_per_visit_with_searches
  %tr
    %td.bottom Number of visits initiated from homepage
    %td.bottom= number_of_visits_initiated_from_homepage


%h4 Most used search keywords
%table.table
  %tr
    %th Ranking
    %th Keywords
    %th # of times searched
  - most_used_keywords.each_with_index do |keyword, i|
    - td_class = (i == most_used_keywords.length-1)? "bottom" : ""
    %tr
      %td{class: td_class} #{i+1}
      %td{class: td_class} #{keyword.first}
      %td{class: td_class} #{keyword.last}


%h4 Most visited locations
%table.table
  %tr
    %th Ranking
    %th{colspan: "2"} Location name
    %th # of visits
  - most_visited_locations.each_with_index do |location, i|
    - location_id = location.first
    %tr.top-locations{tabindex: '0', role: 'button'}
      %td #{i+1}
      %td{colspan: "2"}
        = get_location_name(location_id)
      %td #{location.last}

    - search_keywords = search_details_leading_to_location_visit(location_id)
    - from_direct_links = search_keywords['From direct link'] || 0
    %tr.hidden
      %td.bottom
      %td.bottom
        %p From keyword searches: #{search_keywords.values.sum - from_direct_links}
        - search_keywords.each_with_index do |keywords, j|
          - if keywords.first != 'From direct link'
            %p - #{keywords.first} (#{keywords.second})
      %td.bottom
        %p From direct links: #{from_direct_links}
      %td.bottom

:javascript
  $(document).ready(function() {

    $('tr.top-locations').on('click', function(){
      $(this).next().toggleClass('hidden');
    })
  });
